<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Umpire Call Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            transition: background-color 0.3s ease;
            min-height: 100vh;
            padding: 10px;
        }

        body.called-mode {
            background-color: #444;
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
        }

        .mode-display {
            font-size: 28px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }

        body.called-mode .mode-display {
            color: #fff;
        }

        body.called-mode .container {
            background: #666;
            color: #fff;
        }

        .email-input {
            width: 100%;
            padding: 12px;
            margin-bottom: 20px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px;
        }

        body.called-mode .email-input {
            background: #555;
            color: #fff;
            border-color: #777;
        }

        .strike-zone-container {
            position: relative;
            width: 460px;
            height: 450px;
            margin: 0 auto;
            background: #f9f9f9;
            border-radius: 10px;
        }

        body.called-mode .strike-zone-container {
            background: #555;
        }

        /* Strike zone rectangle */
        .strike-zone {
            position: absolute;
            width: 150px;
            height: 200px;
            background: transparent;
            border: 4px solid #000;
            top: 150px;
            left: 175px;
            z-index: 1;
        }

        .pitch-button {
            position: absolute;
            width: 45px;
            height: 45px;
            border: 2px solid #333;
            border-radius: 50%;
            font-size: 11px;
            font-weight: bold;
            color: #333;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            z-index: 2;
        }

        .pitch-button:hover {
            transform: scale(1.15);
            box-shadow: 0 3px 10px rgba(0,0,0,0.3);
        }

        .pitch-button:active {
            transform: scale(0.95);
        }

        .strike {
            background-color: #ff4444;
            color: white;
            border-color: #cc0000;
        }

        .ball {
            background-color: #44ff44;
            color: black;
            border-color: #00cc00;
        }

        /* Exact button positions from your configuration */
        .btn-strike1 { top: 226px; left: 231px; }
        .btn-ball2 { top: 77px; left: 196px; }
        .btn-ball3 { top: 255px; left: 350px; }
        .btn-strike4 { top: 120px; left: 225px; }
        .btn-strike5 { top: 120px; left: 278px; }
        .btn-strike6 { top: 120px; left: 178px; }
        .btn-strike7 { top: 168px; left: 300px; }
        .btn-strike8 { top: 226px; left: 305px; }
        .btn-strike9 { top: 290px; left: 308px; }
        .btn-strike10 { top: 334px; left: 286px; }
        .btn-strike11 { top: 334px; left: 234px; }
        .btn-strike12 { top: 334px; left: 181px; }
        .btn-strike13 { top: 290px; left: 158px; }
        .btn-strike14 { top: 226px; left: 157px; }
        .btn-strike15 { top: 168px; left: 152px; }
        .btn-ball16 { top: 77px; left: 253px; }
        .btn-ball17 { top: 77px; left: 306px; }
        .btn-ball18 { top: 118px; left: 337px; }
        .btn-ball19 { top: 194px; left: 341px; }
        .btn-ball20 { top: 320px; left: 346px; }
        .btn-ball21 { top: 374px; left: 322px; }
        .btn-ball22 { top: 374px; left: 262px; }
        .btn-ball23 { top: 374px; left: 206px; }
        .btn-ball24 { top: 374px; left: 145px; }
        .btn-ball25 { top: 320px; left: 120px; }
        .btn-ball26 { top: 255px; left: 118px; }
        .btn-ball27 { top: 194px; left: 114px; }
        .btn-ball28 { top: 118px; left: 121px; }
        .btn-ball29 { top: 77px; left: 144px; }

        .data-display {
            margin-top: 20px;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
        }

        body.called-mode .data-display {
            background: #555;
            color: #fff;
        }

        .control-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .reset-btn {
            flex: 1;
            padding: 12px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 14px;
            cursor: pointer;
            font-weight: bold;
        }

        .reset-btn:hover {
            background: #0056b3;
        }

        .export-btn {
            background: #28a745;
        }

        .export-btn:hover {
            background: #1e7e34;
        }

        .clear-btn {
            background: #dc3545;
        }

        .clear-btn:hover {
            background: #c82333;
        }

        .instructions {
            text-align: center;
            margin-bottom: 15px;
            color: #666;
            font-size: 16px;
            font-weight: 500;
        }

        body.called-mode .instructions {
            color: #ccc;
        }

        .stats-summary {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
        }

        .stat-box {
            padding: 8px;
            background: #e9ecef;
            border-radius: 5px;
            text-align: center;
            font-size: 12px;
        }

        body.called-mode .stat-box {
            background: #555;
        }

        .feedback-message {
            text-align: center;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
            display: none;
        }

        .feedback-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .feedback-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="mode-display" id="modeDisplay">Actual</div>
            <input type="email" class="email-input" id="emailInput" placeholder="Enter your email address" required>
            <div class="instructions" id="instructions">Select where the pitch actually landed</div>
            <div class="feedback-message" id="feedbackMessage"></div>
        </div>

        <div class="strike-zone-container">
            <div class="strike-zone"></div>
            
            <!-- All 29 buttons positioned exactly as specified -->
            <button class="pitch-button strike btn-strike1" data-location="1" data-type="S">S1</button>
            <button class="pitch-button ball btn-ball2" data-location="2" data-type="B">B2</button>
            <button class="pitch-button ball btn-ball3" data-location="3" data-type="B">B3</button>
            <button class="pitch-button strike btn-strike4" data-location="4" data-type="S">S4</button>
            <button class="pitch-button strike btn-strike5" data-location="5" data-type="S">S5</button>
            <button class="pitch-button strike btn-strike6" data-location="6" data-type="S">S6</button>
            <button class="pitch-button strike btn-strike7" data-location="7" data-type="S">S7</button>
            <button class="pitch-button strike btn-strike8" data-location="8" data-type="S">S8</button>
            <button class="pitch-button strike btn-strike9" data-location="9" data-type="S">S9</button>
            <button class="pitch-button strike btn-strike10" data-location="10" data-type="S">S10</button>
            <button class="pitch-button strike btn-strike11" data-location="11" data-type="S">S11</button>
            <button class="pitch-button strike btn-strike12" data-location="12" data-type="S">S12</button>
            <button class="pitch-button strike btn-strike13" data-location="13" data-type="S">S13</button>
            <button class="pitch-button strike btn-strike14" data-location="14" data-type="S">S14</button>
            <button class="pitch-button strike btn-strike15" data-location="15" data-type="S">S15</button>
            <button class="pitch-button ball btn-ball16" data-location="16" data-type="B">B16</button>
            <button class="pitch-button ball btn-ball17" data-location="17" data-type="B">B17</button>
            <button class="pitch-button ball btn-ball18" data-location="18" data-type="B">B18</button>
            <button class="pitch-button ball btn-ball19" data-location="19" data-type="B">B19</button>
            <button class="pitch-button ball btn-ball20" data-location="20" data-type="B">B20</button>
            <button class="pitch-button ball btn-ball21" data-location="21" data-type="B">B21</button>
            <button class="pitch-button ball btn-ball22" data-location="22" data-type="B">B22</button>
            <button class="pitch-button ball btn-ball23" data-location="23" data-type="B">B23</button>
            <button class="pitch-button ball btn-ball24" data-location="24" data-type="B">B24</button>
            <button class="pitch-button ball btn-ball25" data-location="25" data-type="B">B25</button>
            <button class="pitch-button ball btn-ball26" data-location="26" data-type="B">B26</button>
            <button class="pitch-button ball btn-ball27" data-location="27" data-type="B">B27</button>
            <button class="pitch-button ball btn-ball28" data-location="28" data-type="B">B28</button>
            <button class="pitch-button ball btn-ball29" data-location="29" data-type="B">B29</button>
        </div>

        <div class="data-display" id="dataDisplay">
            <strong>Collected Data:</strong><br>
            <div id="dataEntries">No entries yet</div>
            <div class="stats-summary" id="statsSummary" style="display: none;">
                <div class="stat-box">
                    <strong>Total Pitches</strong><br>
                    <span id="totalPitches">0</span>
                </div>
                <div class="stat-box">
                    <strong>Umpire Accuracy</strong><br>
                    <span id="accuracy">0%</span>
                </div>
            </div>
        </div>

        <div class="control-buttons">
            <button class="reset-btn clear-btn" onclick="clearAllData()">Clear Data</button>
            <button class="reset-btn export-btn" onclick="exportData()">Export CSV</button>
        </div>
    </div>

    <script>
        let currentMode = 'actual';
        let currentPitch = {};
        let collectedData = [];

        // Load saved data on page load
        window.onload = function() {
            const savedData = localStorage.getItem('umpireTrackerData');
            if (savedData) {
                collectedData = JSON.parse(savedData);
                updateDataDisplay();
            }
        };

        // Add click listeners to all pitch buttons
        document.querySelectorAll('.pitch-button').forEach(button => {
            button.addEventListener('click', function() {
                const location = this.getAttribute('data-location');
                const type = this.getAttribute('data-type');
                
                if (currentMode === 'actual') {
                    handleActualPitch(type, location);
                } else {
                    handleUmpireCall(type, location);
                }
            });
        });

        function showFeedback(message, type = 'success') {
            const feedback = document.getElementById('feedbackMessage');
            feedback.textContent = message;
            feedback.className = `feedback-message feedback-${type}`;
            feedback.style.display = 'block';
            
            setTimeout(() => {
                feedback.style.display = 'none';
            }, 2000);
        }

        function handleActualPitch(type, location) {
            const email = document.getElementById('emailInput').value.trim();
            if (!email) {
                showFeedback('Please enter your email address first', 'error');
                return;
            }

            // Validate email format
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                showFeedback('Please enter a valid email address', 'error');
                return;
            }

            // Store actual pitch data
            currentPitch = {
                email: email,
                timestamp: new Date().toISOString(),
                actualType: type,
                actualLocation: location
            };

            // Switch to called mode
            currentMode = 'called';
            document.body.classList.add('called-mode');
            document.getElementById('modeDisplay').textContent = 'Called';
            document.getElementById('instructions').textContent = 'Select the umpire\'s call and location';
            
            showFeedback(`Actual: ${type}${location} recorded. Now select umpire's call.`);
        }

        function handleUmpireCall(type, location) {
            // Complete the pitch record
            currentPitch.calledType = type;
            currentPitch.calledLocation = location;

            // Add to collected data
            collectedData.push({ ...currentPitch });
            
            // Save to localStorage
            localStorage.setItem('umpireTrackerData', JSON.stringify(collectedData));
            
            // Show completion feedback
            const correct = (currentPitch.actualType === currentPitch.calledType) ? 'CORRECT' : 'INCORRECT';
            showFeedback(`Call recorded: ${type}${location} - ${correct}!`);
            
            // Update display
            updateDataDisplay();

            // Reset for next pitch
            setTimeout(resetForNextPitch, 1500);
        }

        function resetForNextPitch() {
            currentMode = 'actual';
            currentPitch = {};
            document.body.classList.remove('called-mode');
            document.getElementById('modeDisplay').textContent = 'Actual';
            document.getElementById('instructions').textContent = 'Select where the pitch actually landed';
        }

        function calculateAccuracy() {
            if (collectedData.length === 0) return 0;
            
            const correct = collectedData.filter(entry => 
                entry.actualType === entry.calledType
            ).length;
            
            return Math.round((correct / collectedData.length) * 100);
        }

        function updateDataDisplay() {
            const display = document.getElementById('dataEntries');
            const statsDiv = document.getElementById('statsSummary');
            
            if (collectedData.length === 0) {
                display.innerHTML = 'No entries yet';
                statsDiv.style.display = 'none';
                return;
            }

            // Show recent entries
            let html = `<strong>Total entries: ${collectedData.length}</strong><br><br>`;
            html += 'Recent entries:<br>';
            
            const recent = collectedData.slice(-5).reverse();
            recent.forEach((entry) => {
                const correct = entry.actualType === entry.calledType ? '✓' : '✗';
                const status = entry.actualType === entry.calledType ? 'CORRECT' : 'WRONG';
                html += `${entry.actualType}${entry.actualLocation} → ${entry.calledType}${entry.calledLocation} ${correct} ${status}<br>`;
            });

            display.innerHTML = html;

            // Show stats
            document.getElementById('totalPitches').textContent = collectedData.length;
            document.getElementById('accuracy').textContent = calculateAccuracy() + '%';
            statsDiv.style.display = 'grid';
        }

        function clearAllData() {
            if (confirm('Are you sure you want to clear all collected data?')) {
                collectedData = [];
                localStorage.removeItem('umpireTrackerData');
                updateDataDisplay();
                resetForNextPitch();
                showFeedback('All data cleared');
            }
        }

        function exportData() {
            if (collectedData.length === 0) {
                showFeedback('No data to export', 'error');
                return;
            }

            // Create CSV format matching Google Sheets structure
            // Columns: A=Email, B=DateTime, I=ActualCall, J=ActualLocation, K=UmpireCall, L=UmpireLocation
            let csv = 'Email,DateTime,,,,,,,ActualCall,ActualLocation,UmpireCall,UmpireLocation\n';
            
            collectedData.forEach(entry => {
                csv += `"${entry.email}","${entry.timestamp}",,,,,,"","${entry.actualType}","${entry.actualLocation}","${entry.calledType}","${entry.calledLocation}"\n`;
            });

            // Create download link
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `umpire-tracker-data-${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);

            showFeedback(`Exported ${collectedData.length} entries to CSV`);
        }
    </script>
</body>
</html>
